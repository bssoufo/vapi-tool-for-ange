{"analysisPlan": {"minMessagesThreshold": 2, "summaryPlan": {"enabled": true, "timeoutSeconds": 15, "messages": [{"role": "system", "content": "# Sp\u00e9cialiste de Synth\u00e8se Immobili\u00e8re\n\nVous \u00eates assistant IA sp\u00e9cialis\u00e9 dans la synth\u00e8se d'interactions clients immobili\u00e8res en fran\u00e7ais pour le bureau de courtage immobilier de Michelle.\n\n## Objectifs principaux\n- Capturer l'intention du client et ses exigences immobili\u00e8res\n- Identifier les prochaines \u00e9tapes et actions requises\n- \u00c9valuer le niveau d'urgence et de pr\u00e9paration du client\n\n## Directives de synth\u00e8se\n- Soyez concis et orient\u00e9 action\n- Structurez votre r\u00e9sum\u00e9 clairement avec des sections distinctes\n- Mettez en \u00e9vidence les points critiques n\u00e9cessitant un suivi\n- Utilisez des puces pour am\u00e9liorer la lisibilit\u00e9\n- Incluez toujours le sentiment g\u00e9n\u00e9ral et le niveau d'urgence\n\n## Format attendu\nLe r\u00e9sum\u00e9 doit \u00eatre structur\u00e9 en sections claires permettant une action rapide de l'\u00e9quipe commerciale."}, {"role": "user", "content": "# Instructions de Synth\u00e8se\n\nFournissez un r\u00e9sum\u00e9 **EN FRAN\u00c7AIS** de cette conversation immobili\u00e8re incluant:\n\n## 1. Identification du Client\n- **Type de client**: acheteur/vendeur/curieux\n- **\u00c9tape du parcours**: premi\u00e8re fois, d\u00e9butant, inform\u00e9, client existant\n- **Coordonn\u00e9es valid\u00e9es**: nom, t\u00e9l\u00e9phone, courriel\n\n## 2. Exigences Immobili\u00e8res\n- **Type de propri\u00e9t\u00e9 recherch\u00e9**: maison, condo, duplex, terrain\n- **Budget mentionn\u00e9**: gamme de prix ou budget maximum\n- **Secteur de recherche**: quartier, ville ou r\u00e9gion pr\u00e9f\u00e9r\u00e9e\n- **Caract\u00e9ristiques souhait\u00e9es**: nombre de chambres, garage, piscine, etc.\n- **MLS sp\u00e9cifique**: si une propri\u00e9t\u00e9 particuli\u00e8re a \u00e9t\u00e9 discut\u00e9e\n\n## 3. Rendez-vous et Actions\n- **Rendez-vous planifi\u00e9**: type (visite, consultation, appel d\u00e9couverte), date et heure\n- **Actions effectu\u00e9es**: transferts vers sp\u00e9cialistes, r\u00e9servations confirm\u00e9es\n- **Outils utilis\u00e9s**: collecte d'info client, v\u00e9rification calendrier, etc.\n\n## 4. Analyse du Lead\n- **Niveau d'urgence**: imm\u00e9diat / haute / moyenne / basse / exploration\n- **Qualit\u00e9 du lead**: chaud / ti\u00e8de / froid avec facteurs justificatifs\n- **Pr\u00eat \u00e0 agir**: oui/non et timeline anticip\u00e9e\n\n## 5. Suivi Requis\n- **Actions de suivi n\u00e9cessaires**: envoi de listings, rappel du courtier, \u00e9valuation\n- **Priorit\u00e9 du suivi**: haute/moyenne/basse\n- **D\u00e9lai recommand\u00e9**: imm\u00e9diat, dans 24h, cette semaine\n\n## 6. Points d'Attention\n- **Pr\u00e9occupations soulev\u00e9es**: objections, h\u00e9sitations, questions non r\u00e9solues\n- **Opportunit\u00e9s identifi\u00e9es**: potentiel de vente crois\u00e9e, r\u00e9f\u00e9rences possibles\n- **Notes importantes**: d\u00e9tails critiques pour le courtier\n\n**Conversation \u00e0 analyser:**\n{{transcript}}"}]}, "structuredDataPlan": {"enabled": true, "timeoutSeconds": 15, "messages": [{"role": "system", "content": "# Sp\u00e9cialiste d'Extraction de Donn\u00e9es - Bureau Michelle\n\nVous \u00eates sp\u00e9cialiste d'extraction de donn\u00e9es pour le bureau de courtage immobilier de Michelle.\n\n## Mission\nExtrayez les informations structur\u00e9es des conversations immobili\u00e8res en fran\u00e7ais selon le sch\u00e9ma JSON fourni.\n\n## Points d'attention critiques\n\n### Validation des donn\u00e9es\n- **Num\u00e9ros de t\u00e9l\u00e9phone**: V\u00e9rifiez s'ils ont \u00e9t\u00e9 explicitement valid\u00e9s par le client\n- **Adresses de propri\u00e9t\u00e9**: Notez si l'adresse compl\u00e8te a \u00e9t\u00e9 confirm\u00e9e\n- **Rendez-vous**: Marquez si les d\u00e9tails ont \u00e9t\u00e9 confirm\u00e9s avec le client\n\n### S\u00e9quence d'assistants\nIdentifiez pr\u00e9cis\u00e9ment la s\u00e9quence d'assistants impliqu\u00e9s:\n- **Alex**: Assistant de triage initial\n- **Sophie**: Sp\u00e9cialiste des propri\u00e9t\u00e9s\n- **Alex**: Coordinateur de r\u00e9servation\n- Notez l'ordre exact des transferts\n\n### Types de transferts\n- **Transfert silencieux**: Sans annonce au client\n- **Transfert annonc\u00e9**: Avec explication au client\n- **Raison du transfert**: Capturez le motif exact\n\n### Parcours client d\u00e9butant\nPour les acheteurs d\u00e9butants:\n- A-t-on propos\u00e9 un appel d\u00e9couverte?\n- Quelle a \u00e9t\u00e9 la r\u00e9ponse du client?\n- Le pitch a-t-il \u00e9t\u00e9 fait avant ou apr\u00e8s le transfert?\n\n### Identification de la source\n- **Appel t\u00e9l\u00e9phonique**: Le num\u00e9ro du client est disponible\n- **Appel web**: Pas de num\u00e9ro client initial\n- **Inconnu**: Impossible \u00e0 d\u00e9terminer\n\n## Conformit\u00e9 au sch\u00e9ma\n- Retournez EXACTEMENT la structure d\u00e9finie dans le sch\u00e9ma\n- Utilisez `null` pour les valeurs manquantes\n- Ne cr\u00e9ez pas de champs suppl\u00e9mentaires\n- Respectez les types de donn\u00e9es (string, number, boolean, array)\n- Respectez les \u00e9num\u00e9rations d\u00e9finies\n\n## Extraction exhaustive\nExtrayez TOUTES les informations disponibles, m\u00eame si elles semblent mineures. Chaque d\u00e9tail peut \u00eatre important pour le suivi commercial.\n\n**Sch\u00e9ma \u00e0 respecter:** {{schema}}"}, {"role": "user", "content": "# Extraction Compl\u00e8te des Donn\u00e9es de Conversation\n\nExtrayez **TOUTES** les informations de cette conversation immobili\u00e8re en suivant rigoureusement le sch\u00e9ma JSON.\n\n## Checklist d'extraction obligatoire:\n\n### 1. Informations Client (customer_info)\n- [ ] **validated_phone** (CRITIQUE): Format XXX-XXX-XXXX valid\u00e9 explicitement\n- [ ] **first_name**: Pr\u00e9nom du client\n- [ ] **last_name**: Nom de famille\n- [ ] **email**: Adresse courriel si fournie\n- [ ] **customer_known**: Le client \u00e9tait-il d\u00e9j\u00e0 dans la base de donn\u00e9es?\n- [ ] **customer_title**: Monsieur/Madame si mentionn\u00e9\n\n### 2. Classification de l'Appel (call_type)\n- [ ] Type principal: property_inquiry_specific, property_inquiry_beginner, appointment_booking, etc.\n\n### 3. \u00c9tape du Parcours Client (customer_status)\n- [ ] Position dans le parcours: first_time_buyer, beginner_buyer, informed_buyer, etc.\n\n### 4. Routage des Transferts (transfer_info)\n- [ ] **transferred_to**: Vers quel assistant/manager\n- [ ] **transfer_reason**: Raison explicite du transfert\n- [ ] **silent_transfer**: \u00c9tait-ce silencieux (true/false)?\n\n### 5. D\u00e9tails Immobiliers (property_details)\n- [ ] **property_address**: Adresse compl\u00e8te si discut\u00e9e\n- [ ] **property_type**: Type de propri\u00e9t\u00e9 (maison, condo, etc.)\n- [ ] **mls_number**: Num\u00e9ro MLS si mentionn\u00e9\n- [ ] **price_range**: {min: X, max: Y} en CAD\n- [ ] **bedrooms**: Nombre de chambres\n- [ ] **bathrooms**: Nombre de salles de bain\n- [ ] **search_sector**: Zone/quartier de recherche\n- [ ] **property_features**: Liste des caract\u00e9ristiques souhait\u00e9es\n\n### 6. Rendez-vous (appointment_details)\n- [ ] **appointment_type**: Type de rendez-vous\n- [ ] **appointment_date**: Format YYYY-MM-DD\n- [ ] **appointment_time**: Format HH:MM (24h)\n- [ ] **appointment_status**: scheduled, modified, cancelled, pending\n- [ ] **appointment_id**: ID syst\u00e8me si cr\u00e9\u00e9\n\n### 7. Analyse de Sentiment (sentiment_analysis)\n- [ ] **overall_sentiment**: very_positive, positive, neutral, negative, frustrated\n- [ ] **urgency_level**: immediate, high, medium, low, browsing\n- [ ] **readiness_to_act**: ready_to_buy, actively_searching, exploring_options, etc.\n- [ ] **hesitation_factors**: Liste des pr\u00e9occupations\n\n### 8. Scoring du Lead (lead_quality)\n- [ ] **score**: hot, warm, cool, cold\n- [ ] **scoring_factors**: Facteurs justifiant le score\n- [ ] **timeline**: Timeline anticip\u00e9e pour l'action\n\n### 9. Pitch D\u00e9couverte pour D\u00e9butants (discovery_pitch)\n- [ ] **pitch_made**: Le pitch a-t-il \u00e9t\u00e9 fait? (true/false)\n- [ ] **customer_response**: R\u00e9ponse du client au pitch\n- [ ] **discovery_scheduled**: Appel d\u00e9couverte planifi\u00e9? (true/false)\n\n### 10. Messages et Suivi (message_info)\n- [ ] **message_taken**: Message pris pour le courtier? (true/false)\n- [ ] **message_content**: Contenu du message\n- [ ] **callback_requested**: Rappel demand\u00e9? (true/false)\n- [ ] **preferred_callback_time**: Heure pr\u00e9f\u00e9r\u00e9e pour le rappel\n\n### 11. Actions Syst\u00e8me (system_actions)\n- [ ] **tools_triggered**: Liste des outils/fonctions appel\u00e9s\n- [ ] **customer_created**: Nouveau client cr\u00e9\u00e9? (true/false)\n- [ ] **customer_updated**: Client existant mis \u00e0 jour? (true/false)\n- [ ] **calendar_checked**: Disponibilit\u00e9 v\u00e9rifi\u00e9e? (true/false)\n\n### 12. M\u00e9tadonn\u00e9es (call_metadata)\n- [ ] **call_source**: phone_call, web_call, unknown\n- [ ] **call_duration**: Dur\u00e9e en secondes\n- [ ] **assistant_path**: S\u00e9quence des assistants (ex: ['Alex', 'Sophie', 'Alex'])\n- [ ] **language**: french ou english\n\n### 13. Validation des Donn\u00e9es (data_validation)\n- [ ] **phone_validated**: T\u00e9l\u00e9phone valid\u00e9 explicitement? (true/false)\n- [ ] **address_confirmed**: Adresse confirm\u00e9e? (true/false)\n- [ ] **appointment_confirmed**: Rendez-vous confirm\u00e9? (true/false)\n\n### 14. Actions de Suivi (follow_up_actions & follow_up_required)\n- [ ] **follow_up_required**: Suivi n\u00e9cessaire? (true/false)\n- [ ] **follow_up_actions**: Liste des actions avec type, priorit\u00e9 et notes\n\n### 15. R\u00e9sultat de l'Appel (call_outcome)\n- [ ] R\u00e9sultat final: appointment_booked, information_provided, transferred_successfully, etc.\n\n### 16. Notes Additionnelles (notes)\n- [ ] Observations importantes ou d\u00e9tails critiques de la conversation\n\n## IMPORTANT\n- Retournez un JSON valide correspondant EXACTEMENT au sch\u00e9ma\n- Utilisez `null` pour toute valeur manquante ou non mentionn\u00e9e\n- N'inventez JAMAIS de donn\u00e9es - extrayez uniquement ce qui est explicite dans la conversation\n\n**Conversation \u00e0 analyser:**\n{{transcript}}"}], "schema": {"type": "object", "required": ["call_type", "customer_status", "call_outcome", "sentiment_analysis"], "properties": {"customer_info": {"type": "object", "required": ["validated_phone"], "properties": {"validated_phone": {"type": "string", "description": "Validated phone number from customer", "pattern": "^\\d{3}-\\d{3}-\\d{4}$"}, "first_name": {"type": "string", "description": "Customer's first name"}, "last_name": {"type": "string", "description": "Customer's last name"}, "email": {"type": "string", "format": "email", "description": "Customer's email address if provided"}, "customer_known": {"type": "boolean", "description": "Whether customer was found in database"}, "customer_title": {"type": "string", "enum": ["Monsieur", "Madame", null], "description": "Customer title if known"}}}, "call_type": {"type": "string", "enum": ["property_inquiry_specific", "property_inquiry_beginner", "appointment_booking", "appointment_modification", "appointment_cancellation", "message_for_broker", "general_question", "seller_inquiry"], "description": "Primary purpose of the call"}, "customer_status": {"type": "string", "enum": ["first_time_buyer", "beginner_buyer", "informed_buyer", "existing_client", "seller", "browsing_only"], "description": "Stage in real estate journey"}, "transfer_info": {"type": "object", "properties": {"transferred_to": {"type": "string", "enum": ["re-property-manager", "re-booking-manager", "re-triage-manager", "broker_direct", "none"], "description": "Where the call was transferred"}, "transfer_reason": {"type": "string", "description": "Reason for transfer"}, "silent_transfer": {"type": "boolean", "description": "Whether transfer was done silently"}}}, "property_details": {"type": "object", "properties": {"property_address": {"type": "string", "description": "Address of property discussed"}, "property_type": {"type": "string", "enum": ["house", "condo", "duplex", "triplex", "land", "commercial", "not_specified"], "description": "Type of property"}, "mls_number": {"type": "string", "description": "MLS listing number if mentioned"}, "price_range": {"type": "object", "properties": {"min": {"type": "number", "description": "Minimum price in CAD"}, "max": {"type": "number", "description": "Maximum price in CAD"}}}, "bedrooms": {"type": "integer", "minimum": 0, "description": "Number of bedrooms requested"}, "bathrooms": {"type": "number", "minimum": 0, "description": "Number of bathrooms"}, "search_sector": {"type": "string", "description": "Area/sector customer is searching in"}, "property_features": {"type": "array", "items": {"type": "string"}, "description": "Specific features mentioned"}}}, "appointment_details": {"type": "object", "properties": {"appointment_type": {"type": "string", "enum": ["property_showing", "discovery_call", "consultation", "evaluation", "not_specified"], "description": "Type of appointment"}, "appointment_date": {"type": "string", "format": "date", "description": "Scheduled date (YYYY-MM-DD)"}, "appointment_time": {"type": "string", "pattern": "^\\d{2}:\\d{2}$", "description": "Scheduled time in 24h format (HH:MM)"}, "appointment_status": {"type": "string", "enum": ["scheduled", "modified", "cancelled", "pending"], "description": "Current status of appointment"}, "appointment_id": {"type": "string", "description": "System appointment ID if created"}, "previous_appointment": {"type": "object", "properties": {"date": {"type": "string", "format": "date"}, "time": {"type": "string"}}, "description": "Previous appointment details if modified"}}}, "call_outcome": {"type": "string", "enum": ["appointment_booked", "appointment_modified", "appointment_cancelled", "information_provided", "message_taken", "follow_up_scheduled", "transferred_successfully", "customer_will_callback", "no_action_needed"], "description": "Final outcome of the call"}, "sentiment_analysis": {"type": "object", "required": ["overall_sentiment", "urgency_level"], "properties": {"overall_sentiment": {"type": "string", "enum": ["very_positive", "positive", "neutral", "negative", "frustrated"], "description": "Customer's overall emotional tone"}, "urgency_level": {"type": "string", "enum": ["immediate", "high", "medium", "low", "browsing"], "description": "Level of urgency expressed"}, "readiness_to_act": {"type": "string", "enum": ["ready_to_buy", "actively_searching", "exploring_options", "just_browsing", "not_ready"], "description": "Customer's readiness to take action"}, "hesitation_factors": {"type": "array", "items": {"type": "string"}, "description": "Concerns or hesitations mentioned"}}}, "lead_quality": {"type": "object", "properties": {"score": {"type": "string", "enum": ["hot", "warm", "cool", "cold"], "description": "Lead quality assessment"}, "scoring_factors": {"type": "array", "items": {"type": "string"}, "description": "Factors contributing to lead score"}, "timeline": {"type": "string", "enum": ["immediate", "within_week", "within_month", "within_3_months", "over_3_months", "undecided"], "description": "Expected timeline for action"}}}, "discovery_pitch": {"type": "object", "properties": {"pitch_made": {"type": "boolean", "description": "Whether discovery call pitch was made"}, "customer_response": {"type": "string", "enum": ["accepted_immediately", "wants_property_info_first", "hesitant_but_interested", "declined"], "description": "Response to discovery call pitch"}, "discovery_scheduled": {"type": "boolean", "description": "Whether discovery call was scheduled"}}}, "message_info": {"type": "object", "properties": {"message_taken": {"type": "boolean", "description": "Whether a message was taken for broker"}, "message_content": {"type": "string", "description": "Content of message for broker"}, "callback_requested": {"type": "boolean", "description": "Whether customer requested callback"}, "preferred_callback_time": {"type": "string", "description": "Preferred time for callback"}}}, "system_actions": {"type": "object", "properties": {"tools_triggered": {"type": "array", "items": {"type": "string"}, "description": "List of tools/functions called during conversation"}, "customer_created": {"type": "boolean", "description": "Whether new customer record was created"}, "customer_updated": {"type": "boolean", "description": "Whether existing customer record was updated"}, "calendar_checked": {"type": "boolean", "description": "Whether agent availability was checked"}}}, "call_metadata": {"type": "object", "properties": {"call_source": {"type": "string", "enum": ["phone_call", "web_call", "unknown"], "description": "Source of the call"}, "call_duration": {"type": "integer", "description": "Duration in seconds"}, "assistant_path": {"type": "array", "items": {"type": "string"}, "description": "Sequence of assistants involved (e.g., ['Alex', 'Sophie', 'Alex'])"}, "language": {"type": "string", "enum": ["french", "english"], "default": "french", "description": "Language of conversation"}}}, "follow_up_required": {"type": "boolean", "description": "Whether follow-up is needed"}, "follow_up_actions": {"type": "array", "items": {"type": "object", "properties": {"action_type": {"type": "string", "enum": ["send_listings", "broker_callback", "send_evaluation", "schedule_showing", "send_market_info"], "description": "Type of follow-up action"}, "priority": {"type": "string", "enum": ["high", "medium", "low"]}, "notes": {"type": "string", "description": "Additional notes for follow-up"}}}}, "notes": {"type": "string", "description": "Any additional observations or important details from the conversation"}, "data_validation": {"type": "object", "properties": {"phone_validated": {"type": "boolean", "description": "Whether phone number was explicitly validated"}, "address_confirmed": {"type": "boolean", "description": "Whether property address was confirmed"}, "appointment_confirmed": {"type": "boolean", "description": "Whether appointment details were confirmed"}}}}}}}}